<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="Part">
	
	<!-- 查找行政区划与组织机构的关联关系 -->
	<select id="findPartAProductRelation" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select
			t.partId,
			t.productId,
			t.productCode,
			t.productName,
			t.type,
			'' nLevel,
			'' level,
			'' nLevelName,
		    '产品' levelName
		from t_partproduct t
		where t.partId = #partId#
		<isNotEmpty prepend="and" property="productCode">
			(t.productCode like '%$productCode$%' or t.productName like '%$productCode$%')
		</isNotEmpty>
		<isNotEmpty prepend="and" property="type">
			t.type = #type#
		</isNotEmpty>
		order by t.productCode
	</select>
	
	<select id="findPartAProductIsExist" parameterClass="java.util.Map" resultClass="int">
		select count(*) from t_partproduct where partId = #partId# and productId = #productId# and type=#type#
	</select>
	<!-- 添加关联 -->
	<insert id="appendPartAProductRelation" parameterClass="java.util.Map">
		insert into t_partproduct (rid,partId,productId,productCode,productName,type) values (
			REPLACE(UUID(),'-',''),
			#partId#,
			#productId#,
			#productCode#,
			#productName#,
			#type#
		)
	</insert>
	<!-- 移除关联 -->
	<delete id="removePartAProductRelation" parameterClass="java.util.Map">
		delete from t_partproduct where partId = #partId# and productId = #productId#
	</delete>
	
</sqlMap>