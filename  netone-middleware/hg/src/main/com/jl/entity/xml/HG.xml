<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="HG">

	<!-- 查找销售数据 -->
	<select id="findPartAProductRelation" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
			distinct t3.FItemID productId,
			t1.FSupplyID partId,
			org.FName as partName,
			t3.FNumber productCode,
			t3.FName productName,
			'684a303ce5af11e18d0e6cf04976618c' as type,
			t3.F_105 as productLSH,/**条型码*/
			'' nLevel,
			'' level,
			'' nLevelName,
		    '产品' levelName
		from ICStockBill t1 
		left join ICstockBillEntry t2 on t1.FInterID=t2.FInterID
		left join t_ICItem t3 on t3.FItemID=t2.FItemID
		left join t_Organization org on org.FItemID=t1.FSupplyID
		where t1.FSupplyID=#partId# and t3.FDeleted=0
		<!-- 排除已关联类别的产品 -->
		<isNotEmpty property="productIds" prepend="and">
			t2.FItemID not in (
				$productIds$
			)
		</isNotEmpty>
		order by t3.FNumber
	</select>
	
	<!-- 查找想卖数据 -->
	<select id="findPartAProductRelation2" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
			distinct FItemID productId,
			'$partId$' partId,
			(select FName from t_Organization where FItemId='$partId$') as partName,
			FNumber productCode,
			FName productName,
			'a08e8fdee5af11e18d0e6cf04976618c' as type,
			F_105 as productLSH,/**条型码*/
			'' nLevel,
			'' level,
			'' nLevelName,
		    '产品' levelName
		from t_ICItem 
		where FDeleted=0
		<!-- 排除已关联类别的产品 -->
		<isNotEmpty property="productIds" prepend="and">
			FItemID not in (
				$productIds$
			)
		</isNotEmpty>
		order by FNumber
	</select>
	
	<!-- 查找有卖的销售产品信息是否最新 -->
	<select id="findSellInfoIsNew" parameterClass="java.util.Map" resultClass="int">
		select 
			count(distinct t3.FItemID) as countx
		from ICStockBill t1 
		left join ICstockBillEntry t2 on t1.FInterID=t2.FInterID
		left join t_ICItem t3 on t3.FItemID=t2.FItemID
		where t1.FSupplyID=#partId# and t3.FDeleted=0
		<!-- 排除已关联类别的产品 -->
		<isNotEmpty property="productIds" prepend="and">
			t2.FItemID not in (
				$productIds$
			)
		</isNotEmpty>
	</select>
	
	<!-- 加载网点父根节点 HG数据源-->
	<select id="loadPartRoot" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
			SELECT 
			   t.FItemID partId,
			   t.FName partName,
			   t.FFullNumber partCode,
			   '0' parentPartId,
			   '' parentPartCode,
			   '' parentPartName
			FROM t_item t 
			WHERE t.FParentID = #partId# and t.FItemClassID=1 /**and t.FDetail=0**/
			and t.FDeleted=0
			order by t.FFullNumber
	</select>
	
	<!-- 根据上级分类查找子网点　HG数据源-->
	<select id="findChildPart" parameterClass="java.util.Map"
		resultClass="java.util.HashMap">
			SELECT 
			   t.FItemID partId,
			   t.FFullNumber partCode,
			   t.FName partName,
			   t.FParentID parentPartId,
			   tt.FFullNumber parentPartCode,
			   tt.FName parentPartName
			FROM t_item t
			LEFT JOIN t_item tt on t.FParentID = tt.FItemID
			WHERE t.FItemClassID=1 and tt.FItemClassID=1 and t.FParentID = #partId#
			and t.FDeleted=0  and tt.FDeleted=0
			/** and t.FDetail=0  and tt.FDetail=0 **/
			<isNotEmpty property="partCode" prepend="and">
				(t.FShortNumber like '%$partCode$%' or t.FName like '%$partCode$%')
			</isNotEmpty>
			order by t.FFullNumber
	</select>
	
	<!-- 查找所有客户 -->
	<select id="selectAllOrganization" parameterClass="string" resultClass="java.util.HashMap">
		SELECT 
			FItemID partId,FNumber partCode,FName partName
		FROM t_Organization where FDeleted=0
	</select>
	
	<!-- 产品分类 根据上级分类查找子分类　-->
	<select id="findChildCategories" parameterClass="java.lang.String"
		resultClass="java.util.HashMap">
			SELECT 
			   t.FItemID partId,
			   t.FFullNumber partCode,
			   t.FName partName,
			   t.FParentID parentPartId,
			   tt.FFullNumber parentPartCode,
			   tt.FName parentPartName
			FROM t_item t
			LEFT JOIN t_item tt on t.FParentID = tt.FItemID
			WHERE t.FParentID = #categoriesId#
			 and t.FItemClassID=4 
			 and t.FDetail=0
			 and t.FDeleted=0  and tt.FDeleted=0
	</select>
	
	<!-- 查找所有产品的名称和产品的ID号 过时 -->
	<select id="findProductSetByPC" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT 
			FItemID as productId,FNumber as productCode,FName as productName,F_105 as productLSH/**条型码*/
		FROM t_ICItem 
		where FDeleted=0
			<isNotEmpty property="categoriesId" prepend="and">
				FParentID = #categoriesId#
			</isNotEmpty>
			<isNotEmpty property="categoriesCode" prepend="and">
				FNumber like '$categoriesCode$%'
			</isNotEmpty>
			<isNotEmpty property="condition" prepend="and">
				(FNumber like '%$condition$%' or
				FName like '%$condition$%')
			</isNotEmpty>
	</select>
	
	<!-- 查找所有产品的名称和产品的ID号  -->
	<select id="findProductSetByPCX" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT 
		   t.FItemID productId,
		   t.FFullNumber productCode,
		   t.FName productName,
		   '' productLSH/**条型码*/
		FROM t_item t
		LEFT JOIN t_item tt on t.FParentID = tt.FItemID
		WHERE t.FDeleted=0  and tt.FDeleted=0
			<isNotEmpty property="categoriesId" prepend="and">
				t.FParentID = #categoriesId#
			</isNotEmpty>
			<isNotEmpty property="categoriesCode" prepend="and">
				t.FFullNumber like '$categoriesCode$%'
			</isNotEmpty>
			<isNotEmpty property="condition" prepend="and">
				(t.FFullNumber like '%$condition$%' or
				t.FFullNumber like '%$condition$%')
			</isNotEmpty>
	</select>
	
	<!-- 查找所有产品的名称和产品的ID号 过时 -->
	<select id="findProductSetByPC2" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		SELECT 
			FItemID as productId,FNumber as productCode,FName as productName,F_105 as productLSH/**条型码*/
		FROM t_ICItem 
		where FDeleted=0
			<isNotEmpty property="categoriesId" prepend="and">
				FParentID = #categoriesId#
			</isNotEmpty>
			<isNotEmpty property="condition" prepend="and">
				(FNumber like '%$condition$%' or
				FName like '%$condition$%')
			</isNotEmpty>
			<!-- 排除已关联类别的产品 -->
			<isNotEmpty property="productIds" prepend="and">
				FItemID in (
					$productIds$
				)
			</isNotEmpty>
			<isEmpty property="productIds" prepend="and">
				FItemID = 0
			</isEmpty>
	</select>
	
	<!-- 查询职员表 
	FGender
	FPhone
	FShortNumber
	FNumber
	FParentID
	FDepartmentID
	-->
	<select id="selectEmp" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select 
			* 
		from t_emp
		where /**FDeleted=0 and**/ FDepartmentID  in  (
			select FItemID from t_department where FNumber=#deptcode#
		)
	</select>
	
	<!-- 根据职员代码查找职员信息 -->
	<select id="selectEmpByNumber" parameterClass="string" resultClass="java.util.HashMap">
		select * from t_emp where FShortNumber=#code# /**and FDeleted=0**/
	</select>
	
	<!-- 根据父ID查找部门 -->
	<select id="selectDeptByParentID" parameterClass="int" resultClass="java.util.HashMap">
		select * from t_item where FItemClassID=2 and FDeleted=0 and FParentID=#FParentID#
	</select>
	
	<!-- 根据父ID查找部门 -->
	<select id="selectParentDeptInfo" parameterClass="int" resultClass="java.util.HashMap">
		select * from t_item where FItemClassID=2 and FDeleted=0 and FItemID=#FParentID#
	</select>
	
	<!-- 销售出库明细查询 -->
	<select id="querySellOutStorageDetail" parameterClass="java.util.Map" resultClass="java.util.HashMap">
	SELECT 
	[FInterID], [FEntryID], [Fdate], [FCheck], [FCancellation], [FBillNo], [FSaleStyleName], [FSupplyIDName], 
	[FDCStockIDName], [FItemIDName], [FFullNumber], [FItemName], [FItemModel], [FUnitIDName], [FBatchNo], [Fauxqty], 
	[Fauxprice], [Famount], [FFManagerIDName], [FSManagerIDName], [FuserName], [FCheckerName], [FVoucherStatus], [FNote], 
	[FVoucherNumber], [FHookStatus], [FReStatus], [FMarketingStyleName], [FPOOrdBillNo], [FAllHookQTY], [FUNHookQTY], 
	[FCurrentHookQTY], [FOrderBillNo], [FContractBillNo], [FSourceBillNo], [FSourceTranType], [FDeptIDName], 
	[FEmpIDName], [FManagerIDName], [FExplanation], [FFetchAdd], [FCheckDate], [FAuxPropIDName], 
	[FAuxPropIDNumber], [FHasSplitBill], [FAuxQtyInvoice], [FQtyInvoice], [FBaseUnitID], [FBaseQty], 
	[FAuxQtyMust], [FBaseQtyMust], [FAuxPlanPrice], [FPlanAmount], [FCUUnitName], [FCUUnitQty], [FSPName],
	 [FKFPeriod], [FKFDate], [FPeriodDate], [FZPBillNo], [FMapName], [FMapNumber], [FConsignPrice], 
	[FConsignAmount], [FRelateBrIDName], [FBrID], [FDCStockIDNumber], [FSecUnitName], [FSecCoefficient], 
	[FSecQty], [FVIPCardId], [FVIPScore], [FDiscountRate], [FDiscountAmount], [FHolisticDiscountRate],
	 [FPOSName], [FNumber], [FHeadSelfB0144], [FHeadSelfB0145], [FHeadSelfB0146], [FHeadSelfB0147],
	 [FHeadSelfB0148], [FHeadSelfB0149], [FHeadSelfB0150], [FHeadSelfB0151], [FHeadSelfB0152], [FHeadSelfB0153], 
	[FHeadSelfB0154], [FHeadSelfB0155], [FHeadSelfB0156], [FHeadSelfB0157], [FHeadSelfB0158], [FHeadSelfB0159], 
	[FHeadSelfB0160], [FHeadSelfB0161], [FHeadSelfB0162], [FHeadSelfB0163], [FHeadSelfB0164], [FHeadSelfB0165], 
	[FHeadSelfB0166], [FHeadSelfB0167], [FHeadSelfB0168], [FHeadSelfB0169], [FHeadSelfB0170], [FHeadSelfB0171], 
	[FHeadSelfB0172], [FHeadSelfB0173], [FHeadSelfB0174], [FHeadSelfB0175], [FHeadSelfB0176], [FHeadSelfB0177], 
	[FHeadSelfB0178], [FEntrySelfB0155], [FEntrySelfB0156], [FEntrySelfB0157], [FEntrySelfB0158], [FEntrySelfB0159],
	 [FEntrySelfB0160], [FEntrySelfB0161], [FEntrySelfB0162], [FEntrySelfB0163], [FEntrySelfB0164], [FEntrySelfB0165],
	 [FEntrySelfB0166], [FEntrySelfB0167], [FEntrySelfB0168], [FEntrySelfB0169] 
	FROM [vwICBill_8]
	</select>
	
	<!-- 查询销售透视图 -->
	<select id="querySellPivotTable" parameterClass="string" resultClass="java.util.LinkedHashMap" remapResults="true">
		$sql$
	</select>
	
	<!-- 获取列字符SQL -->
	<select id="getRowColumnSql" parameterClass="java.util.Map" resultClass="string">
		select '$function$(case  $column$ when '+quotename($column$,'''')+' then isnull(convert($datatype$,$value$),0) else 0 end) as ' + quotename($column$)+', '  from ($table$) as t group by $column$ order by quotename($column$) 
	</select>
	
</sqlMap>